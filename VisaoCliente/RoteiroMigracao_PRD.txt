### Roteiro dos Passos para a migracao do Visao
###

ROTEIRO DE CARGA

export NLS_LANG=AMERICAN_AMERICA.AL32UTF8

-- Criação das tabelas
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCreateTable.sql

-- Troca de Tabelas Arquivos por Synonyms

sqlplus EbixLA/"Ebx1562#Jan"@aws

GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQ_PORTABILIDADE_INTERNA TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQ_STATUS_CARGA  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQ_STATUS_CARGA_LOG  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_CADA  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_COTA  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_MOVI  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_PAGAMENTO  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_PLAN  TO VISAO_PRD;
GRANT INSERT,SELECT,UPDATE,DELETE ON WISGCICATU_PRD.TB_ARQUIVO_PORTABILIDADE  TO VISAO_PRD;


connect VISAO_PRD/B3TBlc7X@aws

SELECT COUNT(*) FROM TB_ARQ_PORTABILIDADE_INTERNA;
SELECT COUNT(*) FROM TB_ARQ_STATUS_CARGA;
SELECT COUNT(*) FROM TB_ARQ_STATUS_CARGA_LOG;
SELECT COUNT(*) FROM TB_ARQUIVO_CADA;
SELECT COUNT(*) FROM TB_ARQUIVO_COTA;
SELECT COUNT(*) FROM TB_ARQUIVO_MOVI;
SELECT COUNT(*) FROM TB_ARQUIVO_PAGAMENTO;
SELECT COUNT(*) FROM TB_ARQUIVO_PLAN;
SELECT COUNT(*) FROM TB_ARQUIVO_PORTABILIDADE;


drop table TB_ARQ_PORTABILIDADE_INTERNA;
drop table TB_ARQ_STATUS_CARGA;
drop table TB_ARQ_STATUS_CARGA_LOG;
drop table TB_ARQUIVO_CADA;
drop table TB_ARQUIVO_COTA;
drop table TB_ARQUIVO_MOVI;
drop table TB_ARQUIVO_PAGAMENTO;
drop table TB_ARQUIVO_PLAN;
drop table TB_ARQUIVO_PORTABILIDADE;


CREATE SYNONYM TB_ARQ_PORTABILIDADE_INTERNA for WISGCICATU_PRD.TB_ARQ_PORTABILIDADE_INTERNA;
CREATE SYNONYM TB_ARQ_STATUS_CARGA for WISGCICATU_PRD.TB_ARQ_STATUS_CARGA;
CREATE SYNONYM TB_ARQ_STATUS_CARGA_LOG for WISGCICATU_PRD.TB_ARQ_STATUS_CARGA_LOG;
CREATE SYNONYM TB_ARQUIVO_CADA for WISGCICATU_PRD.TB_ARQUIVO_CADA;
CREATE SYNONYM TB_ARQUIVO_COTA for WISGCICATU_PRD.TB_ARQUIVO_COTA;
CREATE SYNONYM TB_ARQUIVO_MOVI for WISGCICATU_PRD.TB_ARQUIVO_MOVI;
CREATE SYNONYM TB_ARQUIVO_PAGAMENTO for WISGCICATU_PRD.TB_ARQUIVO_PAGAMENTO;
CREATE SYNONYM TB_ARQUIVO_PLAN for WISGCICATU_PRD.TB_ARQUIVO_PLAN;
CREATE SYNONYM TB_ARQUIVO_PORTABILIDADE for WISGCICATU_PRD.TB_ARQUIVO_PORTABILIDADE;

SELECT COUNT(*) FROM TB_ARQ_PORTABILIDADE_INTERNA;
SELECT COUNT(*) FROM TB_ARQ_STATUS_CARGA;
SELECT COUNT(*) FROM TB_ARQ_STATUS_CARGA_LOG;
SELECT COUNT(*) FROM TB_ARQUIVO_CADA;
SELECT COUNT(*) FROM TB_ARQUIVO_COTA;
SELECT COUNT(*) FROM TB_ARQUIVO_MOVI;
SELECT COUNT(*) FROM TB_ARQUIVO_PAGAMENTO;
SELECT COUNT(*) FROM TB_ARQUIVO_PLAN;
SELECT COUNT(*) FROM TB_ARQUIVO_PORTABILIDADE;

-- Geração Insert
-- Tabelas Grandes
-- Trocado pela criação de Synonyms (ACIMA)
-- exp EbixLA/"Ebx1562#Jan"@aws file=EXP_TAbelasGrandes.dmp tables=WISGCICATU_PRD.TB_NUM_DOCUMENTO_SEG,WISGCICATU_PRD.TB_ARQ_STATUS_CARGA_LOG,WISGCICATU_PRD.TB_ARQ_STATUS_CARGA,WISGCICATU_PRD.TB_ARQUIVO_PLAN,WISGCICATU_PRD.TB_ARQUIVO_COTA,WISGCICATU_PRD.TB_ARQUIVO_CADA,WISGCICATU_PRD.TB_ARQUIVO_MOVI statistics=none grants=n log=EXP_TAbelasGrandes.log buffer=400000

-- Tabelas de Domínio
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoGeraDadosTabDominios.sql

-- Tabelas de Parceiros
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoGeraDadosParamPorParc.sql


-- Carga dos Dados

sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCargaDadosTabDominios.sql
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCargaDadosParamPorParc.sql

sqlplus VISAO_PRD/B3TBlc7X@aws @scriptTbTemp_Fundos_v4.sql

-- Importação da tabela de TB_INVESTIMENTO/TB_FUNDO/TB_FUNDO_INVESTIMENTO
exp "'/ as sysdba'" file=TB_INVEST_TB_FUNDO_TB_FUNDO_INVEST.dmp tables=DB_EXCHANGE_VISAO_TST.TB_INVESTIMENTO,DB_EXCHANGE_VISAO_TST.TB_FUNDO,DB_EXCHANGE_VISAO_TST.TB_FUNDO_INVESTIMENTO statistics=none grants=n log=EXP_TB_INVEST_TB_FUNDO_TB_FUNDO_INVEST.log buffer=400000
imp EbixLA/"Ebx1562#Jan"@aws file=TB_INVEST_TB_FUNDO_TB_FUNDO_INVEST.dmp fromuser=DB_EXCHANGE_VISAO_TST touser=VISAO_PRD ignore=y rows=y indexes=n constraints=n statistics=none grants=no log=imp_TB_INVEST_TB_FUNDO_TB_FUNDO_INVEST.log

-- Importação da tabela de Layout
exp "'/ as sysdba'" file=TB_LAYOUT_EMAIL.dmp tables=DB_EXCHANGE_VISAO_TST.TB_LAYOUT_EMAIL statistics=none grants=n log=EXP_TB_LAYOUT_EMAIL.log buffer=400000
imp EbixLA/"Ebx1562#Jan"@aws file=TB_LAYOUT_EMAIL.dmp fromuser=DB_EXCHANGE_VISAO_TST touser=VISAO_PRD ignore=y rows=y indexes=n constraints=n statistics=none grants=no log=imp_TB_LAYOUT_EMAIL.log

-- Importação das Grandes Tabelas
-- Subistituído por Synonyms
--imp "'/ as sysdba'" file=EXP_TAbelasGrandes.dmp fromuser=WISGCICATU_PRD touser=DB_EXCHANGE_VISAO_TST ignore=y rows=y indexes=n constraints=n statistics=none grants=no log=imp_tabelasgrandes.log

-- **** UPDATE NA TABELA DE TB_NUM_DOCUMENTO_SEG 

sqlplus EbixLA/"Ebx1562#Jan"@aws

INSERT INTO VISAO_PRD.TB_NUM_DOCUMENTO_SEG select * from WISGCICATU_PRD.TB_NUM_DOCUMENTO_SEG;

connect VISAO_PRD/B3TBlc7X@aws

update TB_NUM_DOCUMENTO_SEG set fl_assinada = 'S' where   num_documento_seg <=  60012964849;
commit;

-- Criação dos índices/constraints
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCreateIndexConstr.sql

grant references on "VISAO_PRD"."TB_MOTIVO_RECUSA" to "WISGCICATU_PRD";

ALTER TABLE "WISGCICATU_PRD"."TB_ARQUIVO_PORTABILIDADE" ADD CONSTRAINT "FK_CJWER3QJ3V8IA2X1S73SIT_02" FOREIGN KEY ("PID_MOTIVO_RECUSA")
          REFERENCES "VISAO_PRD"."TB_MOTIVO_RECUSA" ("ID") ENABLE;
          
-- Criação dos Sequences
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCreateSequence.sql

-- Criação das Triggers
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCreateTriggers.sql

-- Criação das Views
sqlplus EbixLA/"Ebx1562#Jan"@aws @EbixVisaoCreateViews.sql
